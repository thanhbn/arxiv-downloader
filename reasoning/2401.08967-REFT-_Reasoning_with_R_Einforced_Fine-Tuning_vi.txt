# REFT: LÃ½ luáº­n vá»›i Tinh chá»‰nh CÃ³ TÄƒng cÆ°á»ng

Trung Quoc Luongâˆ—, Xinbo Zhangâˆ—, Zhanming Jie*, Peng Sunâ€ , Xiaoran Jin, Hang Li
ByteDance Research
{trung.luong, zhangxinbo.freya, allan.jie}@bytedance.com
{wanhesong, xiaoran.jin, lihang.lh}@bytedance.com

## TÃ³m táº¯t

Má»™t cÃ¡ch Ä‘á»ƒ tÄƒng cÆ°á»ng kháº£ nÄƒng lÃ½ luáº­n cá»§a cÃ¡c MÃ´ hÃ¬nh NgÃ´n ngá»¯ Lá»›n (LLMs) lÃ  thá»±c hiá»‡n Tinh chá»‰nh CÃ³ giÃ¡m sÃ¡t (SFT) sá»­ dá»¥ng cÃ¡c chÃº thÃ­ch Chuá»—i-Suy nghÄ© (CoT). Tuy nhiÃªn, phÆ°Æ¡ng phÃ¡p nÃ y khÃ´ng thá»ƒ hiá»‡n kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a Ä‘á»§ máº¡nh, vÃ¬ quÃ¡ trÃ¬nh huáº¥n luyá»‡n chá»‰ dá»±a vÃ o dá»¯ liá»‡u CoT Ä‘Æ°á»£c cho. VÃ­ dá»¥ trong giáº£i toÃ¡n, thÆ°á»ng chá»‰ cÃ³ má»™t Ä‘Æ°á»ng lÃ½ luáº­n Ä‘Æ°á»£c chÃº thÃ­ch cho má»—i cÃ¢u há»i trong dá»¯ liá»‡u huáº¥n luyá»‡n. Trá»±c quan, sáº½ tá»‘t hÆ¡n náº¿u thuáº­t toÃ¡n há»c tá»« nhiá»u Ä‘Æ°á»ng lÃ½ luáº­n Ä‘Æ°á»£c chÃº thÃ­ch cho má»™t cÃ¢u há»i. Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, chÃºng tÃ´i Ä‘á» xuáº¥t má»™t phÆ°Æ¡ng phÃ¡p Ä‘Æ¡n giáº£n nhÆ°ng hiá»‡u quáº£ gá»i lÃ  Tinh chá»‰nh CÃ³ TÄƒng cÆ°á»ng (ReFT) Ä‘á»ƒ nÃ¢ng cao kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a cá»§a viá»‡c há»c LLMs cho lÃ½ luáº­n, vá»›i giáº£i toÃ¡n lÃ m vÃ­ dá»¥. ReFT Ä‘áº§u tiÃªn khá»Ÿi Ä‘á»™ng mÃ´ hÃ¬nh vá»›i SFT, sau Ä‘Ã³ sá»­ dá»¥ng há»c tÄƒng cÆ°á»ng trá»±c tuyáº¿n, cá»¥ thá»ƒ lÃ  thuáº­t toÃ¡n PPO trong bÃ i bÃ¡o nÃ y, Ä‘á»ƒ tinh chá»‰nh thÃªm mÃ´ hÃ¬nh, trong Ä‘Ã³ nhiá»u Ä‘Æ°á»ng lÃ½ luáº­n Ä‘Æ°á»£c tá»± Ä‘á»™ng láº¥y máº«u cho cÃ¢u há»i vÃ  pháº§n thÆ°á»Ÿng Ä‘Æ°á»£c tá»± nhiÃªn suy ra tá»« cÃ¡c cÃ¢u tráº£ lá»i Ä‘Ãºng. CÃ¡c thÃ­ nghiá»‡m má»Ÿ rá»™ng trÃªn táº­p dá»¯ liá»‡u GSM8K, MathQA, vÃ  SVAMP cho tháº¥y ReFT vÆ°á»£t trá»™i Ä‘Ã¡ng ká»ƒ so vá»›i SFT, vÃ  hiá»‡u suáº¥t cÃ³ thá»ƒ Ä‘Æ°á»£c cáº£i thiá»‡n thÃªm báº±ng cÃ¡ch káº¿t há»£p cÃ¡c chiáº¿n lÆ°á»£c thá»i gian suy luáº­n nhÆ° bá» phiáº¿u Ä‘a sá»‘ vÃ  xáº¿p háº¡ng láº¡i. LÆ°u Ã½ ráº±ng ReFT Ä‘áº¡t Ä‘Æ°á»£c cáº£i thiá»‡n báº±ng cÃ¡ch há»c tá»« cÃ¹ng cÃ¡c cÃ¢u há»i huáº¥n luyá»‡n nhÆ° SFT, mÃ  khÃ´ng dá»±a vÃ o cÃ¢u há»i huáº¥n luyá»‡n bá»• sung hoáº·c tÄƒng cÆ°á»ng. Äiá»u nÃ y cho tháº¥y kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a vÆ°á»£t trá»™i cá»§a ReFT.

## 1 Giá»›i thiá»‡u

CÃ¡c phÆ°Æ¡ng phÃ¡p tiÃªn tiáº¿n nháº¥t Ä‘á»ƒ giáº£i toÃ¡n (Luo et al., 2023; Wang et al., 2023a) sá»­ dá»¥ng Tinh chá»‰nh CÃ³ giÃ¡m sÃ¡t (SFT) Ä‘á»ƒ huáº¥n luyá»‡n mÃ´ hÃ¬nh báº±ng cÃ¡c chÃº thÃ­ch Chuá»—i-Suy nghÄ© (CoT) (Wei et al., 2022). NhÆ° Ä‘Æ°á»£c thá»ƒ hiá»‡n trong HÃ¬nh 1, má»™t chÃº thÃ­ch CoT nÃªu ra cÃ¡c bÆ°á»›c lÃ½ luáº­n trung gian hÆ°á»›ng tá»›i viá»‡c giáº£i quyáº¿t má»™t bÃ i toÃ¡n.

ThÆ°á»ng cÃ³ má»™t chÃº thÃ­ch CoT cho má»—i cÃ¢u há»i trong dá»¯ liá»‡u huáº¥n luyá»‡n, tá»©c lÃ  má»™t Ä‘Æ°á»ng lÃ½ luáº­n Ä‘Ãºng, Ä‘Æ°á»£c sá»­ dá»¥ng trong SFT. ChÃºng tÃ´i quan sÃ¡t tháº¥y Ä‘iá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a tÆ°Æ¡ng Ä‘á»‘i yáº¿u cá»§a cÃ¡c mÃ´ hÃ¬nh SFT. ThÆ°á»ng xáº£y ra trÆ°á»ng há»£p nhiá»u chÃº thÃ­ch CoT há»£p lá»‡ tá»“n táº¡i cho cÃ¹ng má»™t cÃ¢u há»i (Cobbe et al., 2021a; Zhang et al., 2023), nháº¥n máº¡nh nhu cáº§u vá» má»™t phÆ°Æ¡ng phÃ¡p tinh chá»‰nh máº¡nh máº½ hÆ¡n. Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, chÃºng tÃ´i Ä‘á» xuáº¥t má»™t phÆ°Æ¡ng phÃ¡p Ä‘Æ¡n giáº£n nhÆ°ng hiá»‡u quáº£ gá»i lÃ  Tinh chá»‰nh CÃ³ TÄƒng cÆ°á»ng (ReFT) (HÃ¬nh 1 dÆ°á»›i).

ReFT báº¯t Ä‘áº§u vá»›i giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng bao gá»“m Tinh chá»‰nh CÃ³ giÃ¡m sÃ¡t (SFT) trong má»™t hoáº·c hai epoch (HÃ¬nh 1, há»™p tÃ´ mÃ u). Giai Ä‘oáº¡n ban Ä‘áº§u nÃ y trang bá»‹ cho mÃ´ hÃ¬nh kháº£ nÄƒng táº¡o ra cÃ¡c pháº£n há»“i Ä‘Ãºng cho cÃ¡c bÃ i toÃ¡n toÃ¡n há»c á»Ÿ má»™t má»©c Ä‘á»™ nháº¥t Ä‘á»‹nh, nhÆ° Ä‘Ã£ Ä‘Æ°á»£c chá»©ng minh trong cÃ¡c nghiÃªn cá»©u trÆ°á»›c (Cobbe et al., 2021a). Tiáº¿p theo, ReFT tiáº¿n hÃ nh tinh chá»‰nh thÃªm mÃ´ hÃ¬nh thÃ´ng qua viá»‡c sá»­ dá»¥ng thuáº­t toÃ¡n Há»c TÄƒng cÆ°á»ng (RL) trá»±c tuyáº¿n (Sutton and Barto, 2018), cá»¥ thá»ƒ lÃ  Tá»‘i Æ°u hÃ³a ChÃ­nh sÃ¡ch Gáº§n Ä‘Ãºng (PPO) (Schulman et al., 2017) trong bÃ i bÃ¡o nÃ y. Báº±ng cÃ¡ch nÃ y, ReFT cÃ³ thá»ƒ láº¥y máº«u nhiá»u Ä‘Æ°á»ng lÃ½ luáº­n Ä‘Ãºng hoáº·c chÃº thÃ­ch CoT vÃ  há»c tá»« chÃºng (HÃ¬nh 2, pháº£i).

VÃ¬ dá»¯ liá»‡u huáº¥n luyá»‡n bao gá»“m cÃ¡c cÃ¢u tráº£ lá»i Ä‘Ãºng, pháº§n thÆ°á»Ÿng vÃ ng cÃ³ thá»ƒ Ä‘Æ°á»£c tá»± nhiÃªn suy ra tá»« chÃºng khi huáº¥n luyá»‡n PPO. Do Ä‘Ã³, khÃ´ng cáº§n yÃªu cáº§u má»™t mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng Ä‘Æ°á»£c huáº¥n luyá»‡n riÃªng. NgÆ°á»£c láº¡i, RLHF (Ouyang et al., 2022) pháº£i sá»­ dá»¥ng má»™t mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng Ä‘Æ°á»£c há»c tá»« dá»¯ liá»‡u Ä‘Æ°á»£c gÃ¡n nhÃ£n bá»Ÿi con ngÆ°á»i.

Trong giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng, ReFT Ä‘áº¡t Ä‘Æ°á»£c má»™t má»©c Ä‘á»™ chÃ­nh xÃ¡c nháº¥t Ä‘á»‹nh báº±ng há»c cÃ³ giÃ¡m sÃ¡t. Trong giai Ä‘oáº¡n RL, ReFT tiáº¿p tá»¥c nÃ¢ng cao kháº£ nÄƒng cá»§a mÃ¬nh báº±ng há»c tÄƒng cÆ°á»ng thÃ´ng qua viá»‡c láº¥y máº«u cÃ¡c Ä‘Æ°á»ng lÃ½ luáº­n CoT khÃ¡c nhau. Báº±ng cÃ¡ch nÃ y, ReFT nháº­n Ä‘Æ°á»£c tÃ­n hiá»‡u giÃ¡m sÃ¡t phong phÃº hÆ¡n nhiá»u so vá»›i SFT. PhÆ°Æ¡ng phÃ¡p nÃ y cho phÃ©p ReFT cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a trong giáº£i toÃ¡n (Gao et al., 2018; Brown et al., 2020). LÆ°u Ã½ ráº±ng ReFT vÆ°á»£t trá»™i so vá»›i SFT báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¹ng cÃ¡c cÃ¢u há»i huáº¥n luyá»‡n, mÃ  khÃ´ng dá»±a vÃ o cÃ¢u há»i huáº¥n luyá»‡n bá»• sung hoáº·c tÄƒng cÆ°á»ng. Thá»±c táº¿, ReFT khÃ´ng xung Ä‘á»™t vá»›i ká»¹ thuáº­t dá»¯ liá»‡u nhÆ° váº­y vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c káº¿t há»£p má»™t cÃ¡ch liá»n máº¡ch vá»›i nÃ³.

Nhá»¯ng Ä‘Ã³ng gÃ³p cá»§a chÃºng tÃ´i nhÆ° sau:
â€¢ ChÃºng tÃ´i giá»›i thiá»‡u má»™t phÆ°Æ¡ng phÃ¡p tinh chá»‰nh má»›i, tinh chá»‰nh cÃ³ tÄƒng cÆ°á»ng (ReFT), sá»­ dá»¥ng há»c tÄƒng cÆ°á»ng Ä‘á»ƒ giáº£i toÃ¡n. ReFT thá»ƒ hiá»‡n kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a Ä‘Æ°á»£c cáº£i thiá»‡n so vá»›i tinh chá»‰nh cÃ³ giÃ¡m sÃ¡t thÃ´ng thÆ°á»ng khi Ä‘Æ°á»£c huáº¥n luyá»‡n trÃªn cÃ¹ng táº­p dá»¯ liá»‡u.

â€¢ ChÃºng tÃ´i thá»±c hiá»‡n cÃ¡c thÃ­ nghiá»‡m má»Ÿ rá»™ng sá»­ dá»¥ng hai mÃ´ hÃ¬nh ná»n, CodeLLAMA (Roziere et al., 2023) vÃ  Galactica (Taylor et al., 2022), trÃªn ba táº­p dá»¯ liá»‡u chuáº©n: GSM8K (Cobbe et al., 2021a), MathQA (Amini et al., 2019), vÃ  SVAMP (Patel et al., 2021). CÃ¡c thÃ­ nghiá»‡m cá»§a chÃºng tÃ´i bao gá»“m cáº£ CoT ngÃ´n ngá»¯ tá»± nhiÃªn vÃ  dá»±a trÃªn chÆ°Æ¡ng trÃ¬nh, chá»©ng minh hiá»‡u suáº¥t vÃ  kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a Ä‘Æ°á»£c cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ cá»§a ReFT.

â€¢ NgoÃ i ra, chÃºng tÃ´i chá»©ng minh ráº±ng ReFT hÆ°á»Ÿng lá»£i tá»« cáº£ bá» phiáº¿u Ä‘a sá»‘ (Wang et al., 2023b) vÃ  xáº¿p háº¡ng láº¡i mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng (Uesato et al., 2022) táº¡i thá»i gian suy luáº­n, cáº£i thiá»‡n thÃªm hiá»‡u suáº¥t cá»§a nÃ³.

## 2 CÃ´ng trÃ¬nh liÃªn quan

**Giáº£i ToÃ¡n** CÃ¡c ná»— lá»±c nghiÃªn cá»©u gáº§n Ä‘Ã¢y táº­p trung vÃ o thiáº¿t káº¿ prompt CoT vÃ  ká»¹ thuáº­t dá»¯ liá»‡u. Háº§u háº¿t chÃºng Ä‘á»u cá»‘ gáº¯ng lÃ m cho CoT toÃ n diá»‡n vÃ  chi tiáº¿t Ä‘á»ƒ trÃ¬nh bÃ y cÃ¡c giáº£i phÃ¡p lÃ½ luáº­n tá»«ng bÆ°á»›c (Nye et al., 2021; Fu et al., 2023; Zhou et al., 2023b; Khot et al., 2023; Zelikman et al., 2022; Imani et al., 2023; Miao et al., 2023). Gao et al. (2023) tiáº¿p tá»¥c Ä‘á» xuáº¥t sá»­ dá»¥ng chÆ°Æ¡ng trÃ¬nh Python lÃ m prompt CoT, chá»©ng minh cÃ¡c bÆ°á»›c lÃ½ luáº­n chÃ­nh xÃ¡c hÆ¡n vÃ  cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ so vá»›i CoT ngÃ´n ngá»¯ tá»± nhiÃªn (Wei et al., 2022). Zhou et al. (2023a) giá»›i thiá»‡u má»™t phÆ°Æ¡ng phÃ¡p prompting táº¡o mÃ£ Ä‘á»ƒ xÃ¡c minh bÆ°á»›c lÃ½ luáº­n trung gian vá»›i GPT-4 (OpenAI, 2023), tá»« Ä‘Ã³ Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t tiÃªn tiáº¿n trÃªn GSM8K (Cobbe et al., 2021a) vÃ  MATH (Hendrycks et al., 2021). Má»™t hÆ°á»›ng nghiÃªn cá»©u khÃ¡c táº­p trung vÃ o cáº£i thiá»‡n cháº¥t lÆ°á»£ng CoT (Wang et al., 2023a; Liu et al., 2023; Yu et al., 2023) vÃ  tÄƒng lÆ°á»£ng dá»¯ liá»‡u CoT (Luo et al., 2023; Yue et al., 2023) tá»« ChatGPT (gpt-3.5-turbo) hoáº·c GPT-4 cá»§a OpenAI.

**Há»c TÄƒng cÆ°á»ng** CÃ´ng trÃ¬nh cá»§a chÃºng tÃ´i chá»§ yáº¿u liÃªn quan Ä‘áº¿n nghiÃªn cá»©u gáº§n Ä‘Ã¢y Ã¡p dá»¥ng PPO (Schulman et al., 2017) vÃ o xá»­ lÃ½ ngÃ´n ngá»¯ tá»± nhiÃªn Ä‘á»ƒ cÄƒn chá»‰nh sá»Ÿ thÃ­ch cá»§a con ngÆ°á»i (Ouyang et al., 2022). Ká»ƒ tá»« Ä‘Ã³, má»™t sá»‘ thuáº­t toÃ¡n huáº¥n luyá»‡n Ä‘Ã£ Ä‘Æ°á»£c Ä‘á» xuáº¥t Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u quáº£ viá»‡c cÄƒn chá»‰nh, bao gá»“m tá»‘i Æ°u hÃ³a sá»Ÿ thÃ­ch trá»±c tiáº¿p (DPO) (Rafailov et al., 2023), tá»‘i Æ°u hÃ³a sá»Ÿ thÃ­ch nháº­n dáº¡ng (IPO) (Azar et al., 2023), vÃ  tá»‘i Æ°u hÃ³a Kahneman-Tversky (KTO) (Ethayarajh et al., 2023). KhÃ¡c vá»›i má»¥c Ä‘Ã­ch cÄƒn chá»‰nh, chÃºng tÃ´i hÆ°á»›ng Ä‘áº¿n viá»‡c Ã¡p dá»¥ng há»c tÄƒng cÆ°á»ng nhÆ° má»™t mÃ´ hÃ¬nh tinh chá»‰nh Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t so vá»›i tinh chá»‰nh cÃ³ giÃ¡m sÃ¡t thÃ´ng thÆ°á»ng.

Cá»¥ thá»ƒ cho viá»‡c giáº£i toÃ¡n, Uesato et al. (2022) vÃ  Lightman et al. (2023) Ä‘Ã£ huáº¥n luyá»‡n má»™t mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng dá»±a trÃªn káº¿t quáº£ hoáº·c quy trÃ¬nh Ä‘á»ƒ thá»±c hiá»‡n xáº¿p háº¡ng láº¡i (Cobbe et al., 2021a) nháº±m Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t tá»‘t hÆ¡n nhiá»u so vá»›i SFT vÃ  bá» phiáº¿u Ä‘a sá»‘ (Wang et al., 2023b). Trong khi phÆ°Æ¡ng phÃ¡p cá»§a chÃºng tÃ´i nháº±m cáº£i thiá»‡n hiá»‡u suáº¥t cá»§a chÃ­nh sÃ¡ch Ä‘Ã³, cÃ¡c phÆ°Æ¡ng phÃ¡p xáº¿p háº¡ng láº¡i mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng nÃ y cÃ³ thá»ƒ dá»… dÃ ng tÃ­ch há»£p vÃ o mÃ´ hÃ¬nh chÃ­nh sÃ¡ch káº¿t quáº£.

## 3 PhÆ°Æ¡ng phÃ¡p

Trong nghiÃªn cá»©u nÃ y, chÃºng tÃ´i táº­p trung vÃ o CoT ngÃ´n ngá»¯ tá»± nhiÃªn (N-CoT) (Wei et al., 2022) (HÃ¬nh 1) vÃ  CoT dá»±a trÃªn chÆ°Æ¡ng trÃ¬nh (Gao et al., 2023) (P-CoT) sá»­ dá»¥ng Python. Gao et al. (2023) Ä‘Ã£ Ä‘á» xuáº¥t CoT dá»±a trÃªn chÆ°Æ¡ng trÃ¬nh cho viá»‡c giáº£i toÃ¡n. ChÃºng ta cÃ³ thá»ƒ Ä‘Æ¡n giáº£n thá»±c thi chÆ°Æ¡ng trÃ¬nh Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c cÃ¢u tráº£ lá»i. Äá»ƒ Ä‘áº£m báº£o rÃµ rÃ ng vÃ  trÃ¡nh sá»± mÆ¡ há»“, chÃºng tÃ´i sá»­ dá»¥ng cÃ¡c thuáº­t ngá»¯ N-CoT vÃ  P-CoT Ä‘á»ƒ Ä‘áº¡i diá»‡n cho CoT ngÃ´n ngá»¯ tá»± nhiÃªn vÃ  dá»±a trÃªn chÆ°Æ¡ng trÃ¬nh, tÆ°Æ¡ng á»©ng.

### 3.1 Tinh chá»‰nh CÃ³ TÄƒng cÆ°á»ng

QuÃ¡ trÃ¬nh Tinh chá»‰nh CÃ³ TÄƒng cÆ°á»ng (ReFT) Ä‘Æ°á»£c Ä‘á» xuáº¥t bao gá»“m hai giai Ä‘oáº¡n: giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng vÃ  giai Ä‘oáº¡n há»c tÄƒng cÆ°á»ng. Thuáº­t toÃ¡n tá»•ng thá»ƒ Ä‘Æ°á»£c thá»ƒ hiá»‡n trong Thuáº­t toÃ¡n 1.

**Khá»Ÿi Ä‘á»™ng** Trong giai Ä‘oáº¡n nÃ y, chÃ­nh sÃ¡ch Ä‘Æ°á»£c tinh chá»‰nh trong vÃ i epoch trÃªn táº­p dá»¯ liá»‡u bao gá»“m cÃ¡c bá»™ "(cÃ¢u há»i, CoT)": (x,e). NÃ³ cho phÃ©p mÃ´ hÃ¬nh cÃ³ ká»¹ nÄƒng giáº£i quyáº¿t váº¥n Ä‘á» cÆ¡ báº£n Ä‘á»ƒ táº¡o ra pháº£n há»“i phÃ¹ há»£p. ChÃ­nh thá»©c, quÃ¡ trÃ¬nh táº¡o CoT cÃ³ thá»ƒ Ä‘Æ°á»£c phÃ¢n tÃ¡ch thÃ nh má»™t chuá»—i cÃ¡c hÃ nh Ä‘á»™ng dá»± Ä‘oÃ¡n token tiáº¿p theo. Token hÃ nh Ä‘á»™ng cuá»‘i cÃ¹ng, <eos>, bÃ¡o hiá»‡u quÃ¡ trÃ¬nh táº¡o káº¿t thÃºc. CoT e Ä‘Æ°á»£c viáº¿t lÃ :

e = [aâ‚, aâ‚‚, ..., aâ‚—â‚‹â‚, aâ‚—=<eos>]

trong Ä‘Ã³ L Ä‘áº¡i diá»‡n cho Ä‘á»™ dÃ i tá»‘i Ä‘a. Táº¡i thá»i Ä‘iá»ƒm t, hÃ nh Ä‘á»™ng aâ‚œ Ä‘Æ°á»£c láº¥y máº«u tá»« chÃ­nh sÃ¡ch Ï€Î¸(Â·|sâ‚œ) trong Ä‘Ã³ aâ‚œ cÃ³ thá»ƒ lÃ  báº¥t ká»³ token nÃ o trong tá»« vá»±ng vÃ  tráº¡ng thÃ¡i sâ‚œ bao gá»“m táº¥t cáº£ tokens trong cÃ¢u há»i vÃ  táº¥t cáº£ tokens Ä‘Æ°á»£c táº¡o ra cho Ä‘áº¿n nay. Sau má»—i hÃ nh Ä‘á»™ng, tráº¡ng thÃ¡i káº¿t quáº£ sâ‚œâ‚Šâ‚ lÃ  sá»± ná»‘i cá»§a tráº¡ng thÃ¡i hiá»‡n táº¡i sâ‚œ vÃ  hÃ nh Ä‘á»™ng aâ‚œ:

sâ‚œâ‚Šâ‚ = {
    x, t = 0
    [sâ‚œ, aâ‚œ], 1 â‰¤ t â‰¤ L
}

Khi hÃ nh Ä‘á»™ng Ä‘Æ°á»£c táº¡o ra lÃ  token <eos>, tráº¡ng thÃ¡i káº¿t quáº£ sâ‚—â‚Šâ‚ lÃ  tráº¡ng thÃ¡i káº¿t thÃºc vÃ  quÃ¡ trÃ¬nh táº¡o hoÃ n thÃ nh. Vá»›i kÃ½ hiá»‡u nÃ y, hÃ m máº¥t mÃ¡t cho má»™t máº«u cÃ³ thá»ƒ Ä‘Æ°á»£c viáº¿t lÃ :

LSFT(Î¸) = -ğ”¼e~D[âˆ‘á´¸â‚œâ‚Œâ‚ log(Ï€Î¸(aâ‚œ|sâ‚œ))]     (1)

**Há»c TÄƒng cÆ°á»ng** Trong giai Ä‘oáº¡n nÃ y, chÃ­nh sÃ¡ch cáº£i thiá»‡n hiá»‡u suáº¥t cá»§a mÃ¬nh thÃ´ng qua má»™t hÃ¬nh thá»©c tá»± há»c trá»±c tuyáº¿n sá»­ dá»¥ng táº­p dá»¯ liá»‡u bao gá»“m cÃ¡c bá»™ (cÃ¢u há»i, cÃ¢u tráº£ lá»i): (x,y). Cá»¥ thá»ƒ, mÃ´ hÃ¬nh chÃ­nh sÃ¡ch há»c báº±ng cÃ¡ch liÃªn tá»¥c láº¥y máº«u cÃ¡c pháº£n há»“i (HÃ¬nh 2), Ä‘Ã¡nh giÃ¡ tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a cÃ¢u tráº£ lá»i vÃ  cáº­p nháº­t cÃ¡c tham sá»‘ cá»§a nÃ³ theo cÃ¡ch trá»±c tuyáº¿n (dÃ²ng 7-14 trong Thuáº­t toÃ¡n 1). ChÃºng tÃ´i sá»­ dá»¥ng PPO (Schulman et al., 2017) vá»›i thuáº­t toÃ¡n má»¥c tiÃªu bá»‹ cáº¯t Ä‘á»ƒ huáº¥n luyá»‡n. Theo Ziegler et al. (2019), mÃ´ hÃ¬nh giÃ¡ trá»‹ VÏ† Ä‘Æ°á»£c xÃ¢y dá»±ng báº±ng cÃ¡ch thÃªm má»™t Ä‘áº§u giÃ¡ trá»‹ tuyáº¿n tÃ­nh trÃªn cÃ¡c tráº¡ng thÃ¡i áº©n cuá»‘i cÃ¹ng cá»§a mÃ´ hÃ¬nh chÃ­nh sÃ¡ch Ï€Î¸, Ä‘Ã¢y lÃ  mÃ´ hÃ¬nh sau giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng. Pháº§n thÆ°á»Ÿng 0 Ä‘Æ°á»£c Ä‘Æ°a ra cho táº¥t cáº£ hÃ nh Ä‘á»™ng dáº«n Ä‘áº¿n tráº¡ng thÃ¡i khÃ´ng káº¿t thÃºc. Táº¡i tráº¡ng thÃ¡i káº¿t thÃºc, chÃºng tÃ´i sá»­ dá»¥ng má»™t hÃ m pháº§n thÆ°á»Ÿng trá»±c tiáº¿p so sÃ¡nh cÃ¢u tráº£ lá»i Ä‘Æ°á»£c trÃ­ch xuáº¥t tá»« CoT cá»§a tráº¡ng thÃ¡i vÃ  cÃ¢u tráº£ lá»i Ä‘Ãºng y. á» Ä‘Ã¢y, hÃ m pháº§n thÆ°á»Ÿng tráº£ vá» 1 náº¿u cÃ¢u tráº£ lá»i Ä‘Æ°á»£c coi lÃ  Ä‘Ãºng, ngÆ°á»£c láº¡i tráº£ vá» 0. TrÃªn táº­p dá»¯ liá»‡u cÃ³ cÃ¢u tráº£ lá»i Ä‘á»u lÃ  sá»‘, pháº§n thÆ°á»Ÿng má»™t pháº§n (Zhong et al., 2017; Le et al., 2022) lÃ  0.1 cÃ³ thá»ƒ Ä‘Æ°á»£c Ã¡p dá»¥ng khi cÃ¢u tráº£ lá»i cÃ³ thá»ƒ Ä‘Æ°á»£c trÃ­ch xuáº¥t vÃ  lÃ  loáº¡i sá»‘. Cho 1 â‰¤ t â‰¤ L, chÃºng ta viáº¿t:

r(sâ‚œ, aâ‚œ, sâ‚œâ‚Šâ‚) = {
    1, EXTRACT(sâ‚œâ‚Šâ‚) = y
    0.1, EXTRACT(sâ‚œâ‚Šâ‚) â‰  null, â‰  y
    0, EXTRACT(sâ‚œâ‚Šâ‚) = null
}

Pháº§n thÆ°á»Ÿng má»™t pháº§n nhÆ° váº­y cÃ³ thá»ƒ giÃºp giáº£m hiá»‡u á»©ng há»c tá»« pháº§n thÆ°á»Ÿng thÆ°a thá»›t (Riedmiller et al., 2018; Trott et al., 2019). NgoÃ i ra, theo Zheng et al. (2023), tá»•ng pháº§n thÆ°á»Ÿng cá»§a chÃºng tÃ´i lÃ  tá»•ng cá»§a Ä‘iá»ƒm hÃ m pháº§n thÆ°á»Ÿng vÃ  phÃ¢n ká»³ Kullback-Leibler (KL) (Kullback and Leibler, 1951) giá»¯a chÃ­nh sÃ¡ch RL Ä‘Ã£ há»c vÃ  chÃ­nh sÃ¡ch ban Ä‘áº§u Ä‘Æ°á»£c chia tá»· lá»‡ bá»Ÿi há»‡ sá»‘ Î².

râ‚œâ‚’â‚œâ‚â‚—(sâ‚œ, aâ‚œ, sâ‚œâ‚Šâ‚) = r(sâ‚œ, aâ‚œ, sâ‚œâ‚Šâ‚) - Î²KL(Ï€Î¸(Â·|sâ‚œ), Ï€â½â°â¾Î¸(Â·|sâ‚œ))

Æ¯á»›c lÆ°á»£ng lá»£i tháº¿ tá»•ng quÃ¡t (Schulman et al., 2018) Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ tÃ­nh toÃ¡n lá»£i tháº¿:

Ã‚â‚œ = âˆ‘á´¸â»áµ—â‚—â‚Œâ‚€ (Î³Î»)Ë¡Î´â‚œâ‚Šâ‚—

trong Ä‘Ã³ Temporal Difference (TD) Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a lÃ :
Î´â‚œâ€² = -VÏ†(sâ‚œâ€²) + râ‚œâ‚’â‚œâ‚â‚—(sâ‚œâ€², aâ‚œâ€², sâ‚œâ€²â‚Šâ‚) + Î³VÏ†(sâ‚œâ€²â‚Šâ‚)

vá»›i giÃ¡ trá»‹ tráº¡ng thÃ¡i káº¿t thÃºc VÏ†(sâ‚—â‚Šâ‚) := 0, Î» âˆˆ (0,1] lÃ  há»‡ sá»‘ chiáº¿t kháº¥u cho pháº§n thÆ°á»Ÿng, vÃ  Î³ âˆˆ [0,1] lÃ  há»‡ sá»‘ chiáº¿t kháº¥u cho TD. Äá»‘i vá»›i Æ°á»›c lÆ°á»£ng lá»£i nhuáº­n, chÃºng tÃ´i táº­n dá»¥ng Î»-return RÌ‚â‚œ, cÃ³ thá»ƒ Ä‘Æ°á»£c viáº¿t lÃ  tá»•ng cá»§a Æ°á»›c lÆ°á»£ng lá»£i tháº¿ tá»•ng quÃ¡t vÃ  Æ°á»›c lÆ°á»£ng giÃ¡ trá»‹:

RÌ‚â‚œ = Ã‚â‚œ + VÏ†(sâ‚œ)

Cuá»‘i cÃ¹ng, cÃ¡c má»¥c tiÃªu chÃ­nh sÃ¡ch vÃ  giÃ¡ trá»‹ cÃ³ thá»ƒ Ä‘Æ°á»£c viáº¿t trong hai phÆ°Æ¡ng trÃ¬nh dÆ°á»›i Ä‘Ã¢y:

Lâ‚šâ‚’â‚—áµ¢cáµ§(Î¸) = -ğ”¼e~Ï€Î¸â‚’â‚—d[min(Ï€Î¸(aâ‚œ|sâ‚œ)/Ï€Î¸â‚’â‚—d(aâ‚œ|sâ‚œ)Ã‚â‚œ, clip(Ï€Î¸(aâ‚œ|sâ‚œ)/Ï€Î¸â‚’â‚—d(aâ‚œ|sâ‚œ), 1-Îµ, 1+Îµ)Ã‚â‚œ)]

Láµ¥â‚â‚—áµ¤â‚‘(Ï†) = Â½ğ”¼e~Ï€Î¸â‚’â‚—d[max(|VÏ†(sâ‚œ) - RÌ‚â‚œ|Â², |clip(RÌ‚â‚œ - VÏ†(sâ‚œ), Ã‚â‚œ - Îµ, Ã‚â‚œ + Îµ)|Â²)]

trong Ä‘Ã³ Ï€Î¸â‚’â‚—d, VÏ†â‚’â‚—d Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ láº¥y máº«u CoT vÃ  tÃ­nh toÃ¡n Ã‚â‚œ, RÌ‚â‚œ. HÃ m máº¥t mÃ¡t thá»‘ng nháº¥t lÃ  tá»•ng cÃ³ trá»ng sá»‘ cá»§a cÃ¡c má»¥c tiÃªu trÃªn.

LRL(Î¸,Ï†) = Lâ‚šâ‚’â‚—áµ¢cáµ§ + Î±Láµ¥â‚â‚—áµ¤â‚‘     (2)

trong Ä‘Ã³ Î± lÃ  há»‡ sá»‘ cho má»¥c tiÃªu giÃ¡ trá»‹.

## 4 ThÃ­ nghiá»‡m

### 4.1 Táº­p dá»¯ liá»‡u

ChÃºng tÃ´i thá»±c hiá»‡n thÃ­ nghiá»‡m trÃªn ba táº­p dá»¯ liá»‡u bÃ i toÃ¡n: GSM8K (Cobbe et al., 2021a), SVAMP (Patel et al., 2021) vÃ  MathQA (Amini et al., 2019). Äá»‘i vá»›i cáº£ GSM8K vÃ  SVAMP, Ä‘á»‹nh dáº¡ng cÃ¢u tráº£ lá»i lÃ  má»™t giÃ¡ trá»‹ sá»‘. Trong MathQA, Ä‘á»‹nh dáº¡ng thay vÃ o Ä‘Ã³ lÃ  danh sÃ¡ch nhiá»u lá»±a chá»n (tá»©c lÃ  ABCD). Báº£ng 1 trÃ¬nh bÃ y thá»‘ng kÃª cá»§a táº¥t cáº£ táº­p dá»¯ liá»‡u. ChÃºng tÃ´i thá»±c hiá»‡n prompting few-shot (Wei et al., 2022; Gao et al., 2023) sá»­ dá»¥ng GPT-3.5-turbo Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c cáº£ chÃº thÃ­ch N-CoT vÃ  P-CoT. CÃ¡c chÃº thÃ­ch N-CoT vÃ  P-CoT Ä‘Æ°á»£c thu tháº­p theo Jie et al. (2023). ChÃºng tÃ´i cÅ©ng Ä‘Ã£ thá»±c hiá»‡n má»™t thÃ­ nghiá»‡m bá»• sung trÃªn phiÃªn báº£n sá»‘ cá»§a MathQA (Jie and Lu, 2023) trong Ä‘Ã³ Ä‘á»‹nh dáº¡ng cÅ©ng lÃ  má»™t giÃ¡ trá»‹ sá»‘. Nhá»¯ng thÃ­ nghiá»‡m nhÆ° váº­y Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chá»©ng minh giáº£ Ä‘á»‹nh cá»§a chÃºng tÃ´i vá» hiá»‡n tÆ°á»£ng reward hacking tiá»m nÄƒng (Skalse et al., 2022) trÃªn MathQA (Â§4.4).

### 4.2 Baseline

ChÃºng tÃ´i so sÃ¡nh ReFT vá»›i cÃ¡c baseline SFT vÃ  self-training (Xie et al., 2020; Amini et al., 2022). SFT Ä‘Æ¡n giáº£n tinh chá»‰nh mÃ´ hÃ¬nh ngÃ´n ngá»¯ trÃªn dá»¯ liá»‡u huáº¥n luyá»‡n. CÃ¡c thÃ­ nghiá»‡m vá»›i phÆ°Æ¡ng phÃ¡p self-training Ä‘áº£m báº£o so sÃ¡nh tÆ°Æ¡ng Ä‘á»‘i cÃ´ng báº±ng vÃ¬ nhá»¯ng phÆ°Æ¡ng phÃ¡p nÃ y chia sáº» cÆ¡ cháº¿ mÃ  cÃ¡c máº«u Ä‘Æ°á»£c táº¡o tá»« mÃ´ hÃ¬nh Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ huáº¥n luyá»‡n.

ChÃºng tÃ´i Ä‘Ã£ triá»ƒn khai Offline Self-Training (Offline-ST) (He et al., 2020), vÃ  Online (Hoi et al., 2021) Self-Training (Online-ST). PhÆ°Æ¡ng phÃ¡p Offline-ST tÆ°Æ¡ng tá»± nhÆ° expert iteration (Anthony et al., 2017; Uesato et al., 2022; Zelikman et al., 2022). ChÃºng tÃ´i Ä‘áº§u tiÃªn sá»­ dá»¥ng checkpoint SFT tá»« checkpoint sá»›m Ä‘á»ƒ láº¥y máº«u CoTs vÃ  xÃ¡c minh chÃºng vá»›i ground truth. ChÃºng tÃ´i chá»‰ giá»¯ láº¡i nhá»¯ng máº«u expert cÃ³ cÃ¢u tráº£ lá»i Ä‘Ãºng. ChÃºng tÃ´i thá»±c hiá»‡n SFT trÃªn sá»± káº¿t há»£p cá»§a dá»¯ liá»‡u huáº¥n luyá»‡n gá»‘c vÃ  cÃ¡c máº«u expert.

PhÆ°Æ¡ng phÃ¡p Online-ST Ä‘Æ°á»£c táº¡o ra Ä‘á»ƒ cÃ³ thá»ƒ so sÃ¡nh cháº·t cháº½ vá»›i ReFT. Theo ReFT, Online-ST cÃ³ cÃ¹ng quÃ¡ trÃ¬nh khá»Ÿi Ä‘á»™ng. Sau Ä‘Ã³, chÃºng tÃ´i thá»±c hiá»‡n huáº¥n luyá»‡n liÃªn tá»¥c vá»›i cÃ¡c máº«u Ä‘Æ°á»£c táº¡o ra ngay láº­p tá»©c. Táº¡i má»—i bÆ°á»›c huáº¥n luyá»‡n, mÃ´ hÃ¬nh Ä‘áº§u tiÃªn láº¥y máº«u CoTs cho má»™t batch vÃ  chá»‰ giá»¯ láº¡i nhá»¯ng cÃ¡i cÃ³ cÃ¢u tráº£ lá»i Ä‘Ãºng. Batch káº¿t quáº£ bao gá»“m cáº£ CoTs Ä‘Æ°á»£c láº¥y máº«u vÃ  ground-truth. Sau Ä‘Ã³ chÃºng tÃ´i cáº­p nháº­t cÃ¡c tham sá»‘ mÃ´ hÃ¬nh trÃªn batch nÃ y vá»›i má»¥c tiÃªu tinh chá»‰nh cÃ³ giÃ¡m sÃ¡t LSFT. So vá»›i ReFT, Online-ST khÃ´ng sá»­ dá»¥ng cÃ¡c pháº£n há»“i tiÃªu cá»±c (vá»›i cÃ¢u tráº£ lá»i sai) cÅ©ng khÃ´ng cÃ³ cÆ¡ cháº¿ chuyÃªn dá»¥ng Ä‘á»ƒ ngÄƒn mÃ´ hÃ¬nh phÃ¢n ká»³ Ä‘Ã¡ng ká»ƒ khá»i mÃ´ hÃ¬nh ban Ä‘áº§u, Ä‘iá»u nÃ y cÃ³ thá»ƒ biá»ƒu hiá»‡n nhÆ° overfitting cá»¥ thá»ƒ cho tÃ¡c vá»¥ vÃ  báº¥t á»•n Ä‘á»‹nh huáº¥n luyá»‡n.

### 4.3 Thiáº¿t láº­p thÃ­ nghiá»‡m

ChÃºng tÃ´i thá»±c hiá»‡n thÃ­ nghiá»‡m vá»›i hai mÃ´ hÃ¬nh ná»n: Galactica-6.7B (Taylor et al., 2022) vÃ  CodeLLAMA-7B (Roziere et al., 2023). Cáº£ hai mÃ´ hÃ¬nh Ä‘á»u Ä‘Æ°á»£c bÃ¡o cÃ¡o cÃ³ hiá»‡u suáº¥t máº¡nh trong giáº£i toÃ¡n vÃ  thÆ°á»ng Ä‘Æ°á»£c Ã¡p dá»¥ng trong vÄƒn há»‡ gáº§n Ä‘Ã¢y vá» cÃ¡c tÃ¡c vá»¥ lÃ½ luáº­n (Yue et al., 2023; Luo et al., 2023).

NgoÃ i viá»‡c so sÃ¡nh vá»›i baselines, chÃºng tÃ´i cÅ©ng Ã¡p dá»¥ng cÃ¡c ká»¹ thuáº­t phá»• biáº¿n, bá» phiáº¿u Ä‘a sá»‘ (Wang et al., 2023b) vÃ  xáº¿p háº¡ng láº¡i mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng (Lightman et al., 2023) trÃªn GSM8K.

**SiÃªu tham sá»‘** Trong táº¥t cáº£ thÃ­ nghiá»‡m, viá»‡c huáº¥n luyá»‡n Ä‘Æ°á»£c thá»±c hiá»‡n vá»›i 8 GPU A100-80GB sá»­ dá»¥ng DeepSpeed (Rajbhandari et al., 2020; Rasley et al., 2020) Zero stage 2 vÃ  HuggingFace Accelerate (Gugger et al., 2022). Trong giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng cá»§a ReFT, chÃºng tÃ´i sá»­ dá»¥ng optimizer AdamW (Loshchilov and Hutter, 2017) vá»›i tá»· lá»‡ khá»Ÿi Ä‘á»™ng 10%. KÃ­ch thÆ°á»›c batch lÃ  48 vÃ  learning rate lÃ  1e-5. Äá»™ dÃ i tá»‘i Ä‘a Ä‘Æ°á»£c Ä‘áº·t lÃ  1024. Sá»‘ epoch trong giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng lÃ  2 trong táº¥t cáº£ thiáº¿t láº­p trá»« trÃªn MathQA MCQ vÃ  MathQA numeric trong Ä‘Ã³ chÃºng tÃ´i sá»­ dá»¥ng lÃªn Ä‘áº¿n 5 vÃ  10 tÆ°Æ¡ng á»©ng. MÃ´ hÃ¬nh Ä‘Æ°á»£c huáº¥n luyá»‡n trong 300 epoch vá»›i learning rate 3e-7. Theo Ziegler et al. (2019), Î», Î³, Î±, Îµ vÃ  U trong PPO Ä‘Æ°á»£c Ä‘áº·t láº§n lÆ°á»£t lÃ  1, 0.95, 5, 0.2, vÃ  2. Há»‡ sá»‘ KL Î² Ä‘Æ°á»£c Ä‘áº·t lÃ  0.01 cho P-CoT vÃ  Ä‘Æ°á»£c Ä‘áº·t lÃ  0.05 cho cÃ¡c thÃ­ nghiá»‡m N-CoT. CÃ¡c thiáº¿t láº­p siÃªu tham sá»‘ khÃ¡c vá» ReFT cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m tháº¥y trong Phá»¥ lá»¥c B.

Äá»‘i vá»›i baseline SFT, chÃºng tÃ´i huáº¥n luyá»‡n mÃ´ hÃ¬nh trong 40 epoch vÃ  chá»n checkpoint cÃ³ hiá»‡u suáº¥t tá»‘t nháº¥t. Sá»‘ epoch nÃ y Ä‘Ã£ Ä‘Æ°á»£c chá»n Ä‘á»§ lá»›n Ä‘á»ƒ Ä‘áº£m báº£o SFT há»™i tá»¥. Äá»‘i vá»›i baseline Offline-ST, chÃºng tÃ´i láº¥y máº«u CoTs báº±ng cÃ¡ch sá»­ dá»¥ng checkpoint tá»« giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng ReFT. Sá»­ dá»¥ng nhiá»‡t Ä‘á»™ táº¡o 1.0 vÃ  Ä‘á»™ dÃ i tá»‘i Ä‘a 1024, chÃºng tÃ´i láº¥y máº«u 100 CoTs cho má»—i cÃ¢u há»i vÃ  chá»‰ giá»¯ nhá»¯ng cÃ¡i cÃ³ cÃ¢u tráº£ lá»i Ä‘Ãºng. Theo Singh et al. (2023), sau Ä‘Ã³ chÃºng tÃ´i láº¥y máº«u phá»¥ CoTs thÃ nh 10 CoTs ngáº«u nhiÃªn duy nháº¥t cho má»—i cÃ¢u há»i Ä‘á»ƒ cÃ¢n báº±ng Ä‘á»™ khÃ³ cá»§a cÃ¡c cÃ¢u há»i. Sá»‘ epoch tinh chá»‰nh Ä‘Æ°á»£c Ä‘áº·t lÃ  20, Ä‘á»§ lá»›n Ä‘á»ƒ Ä‘áº£m báº£o huáº¥n luyá»‡n há»™i tá»¥. NhÆ° Ä‘Ã£ Ä‘á» cáº­p trong Â§4.2, baseline Online-ST cá»‘ gáº¯ng báº¯t chÆ°á»›c cÃ¹ng thiáº¿t láº­p nhÆ° trong ReFT. ChÃºng tÃ´i cÃ³ cÃ¹ng quÃ¡ trÃ¬nh khá»Ÿi Ä‘á»™ng vÃ  thiáº¿t láº­p siÃªu tham sá»‘ gáº§n giá»‘ng nhÆ° ReFT.

**Xáº¿p háº¡ng láº¡i MÃ´ hÃ¬nh Pháº§n thÆ°á»Ÿng** Theo (Cobbe et al., 2021a; Uesato et al., 2022), chÃºng tÃ´i huáº¥n luyá»‡n má»™t mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng (RM) Ä‘á»ƒ xÃ¡c Ä‘á»‹nh tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a CoT. Äá»ƒ xÃ¢y dá»±ng dá»¯ liá»‡u huáº¥n luyá»‡n RM, chÃºng tÃ´i sá»­ dá»¥ng mÃ´ hÃ¬nh tá»« giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng vÃ  thá»±c hiá»‡n láº¥y máº«u Ä‘á»ƒ thu Ä‘Æ°á»£c 100 CoTs cho má»—i cÃ¢u há»i trong táº­p huáº¥n luyá»‡n. CÃ¡c CoTs Ä‘Æ°á»£c khá»­ trÃ¹ng vÃ  cÃ¡c nhÃ£n nhá»‹ phÃ¢n cÃ³ thá»ƒ Ä‘Æ°á»£c thu Ä‘Æ°á»£c báº±ng cÃ¡ch so sÃ¡nh cÃ¢u tráº£ lá»i Ä‘Æ°á»£c trÃ­ch xuáº¥t vá»›i ground truth.

NhÆ° má»™t thá»±c hÃ nh phá»• biáº¿n, mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng lÃ  má»™t mÃ´ hÃ¬nh ngÃ´n ngá»¯ Ä‘Æ°á»£c khá»Ÿi táº¡o tá»« checkpoint SFT tá»‘t nháº¥t (Cobbe et al., 2021a; Ouyang et al., 2022). TÆ°Æ¡ng tá»± nhÆ° mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng dá»±a trÃªn káº¿t quáº£ (ORM) (Uesato et al., 2022), mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng Ä‘Æ°á»£c huáº¥n luyá»‡n Ä‘á»ƒ dá»± Ä‘oÃ¡n má»™t nhÃ£n nhá»‹ phÃ¢n chá»‰ ra giáº£i phÃ¡p "Ä‘Ãºng" hoáº·c "sai". Khi Ä‘áº§u vÃ o Ä‘i qua mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng, phÃ¢n loáº¡i Ä‘Æ°á»£c thá»±c hiá»‡n vá»›i má»™t bá»™ phÃ¢n loáº¡i tuyáº¿n tÃ­nh trÃªn tráº¡ng thÃ¡i áº©n cá»§a token cuá»‘i cÃ¹ng. Cuá»‘i cÃ¹ng, giáº£i phÃ¡p cÃ³ Ä‘iá»ƒm "Ä‘Ãºng" cao nháº¥t trong sá»‘ cÃ¡c á»©ng viÃªn Ä‘Æ°á»£c chá»n lÃ m cÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng. ChÃºng tÃ´i huáº¥n luyá»‡n mÃ´ hÃ¬nh RM trong 3 epoch sá»­ dá»¥ng kÃ­ch thÆ°á»›c batch 24, Ä‘á»™ dÃ i tá»‘i Ä‘a 700 vÃ  lá»‹ch learning rate tuyáº¿n tÃ­nh vá»›i giai Ä‘oáº¡n khá»Ÿi Ä‘á»™ng 10% vÃ  learning rate tá»‘i Ä‘a 1e-6.

**ÄÃ¡nh giÃ¡** ChÃºng tÃ´i bÃ¡o cÃ¡o Ä‘á»™ chÃ­nh xÃ¡c giÃ¡ trá»‹ cho cáº£ N-CoT vÃ  P-CoT trÃªn táº¥t cáº£ táº­p dá»¯ liá»‡u. Äá»‘i vá»›i bá» phiáº¿u Ä‘a sá»‘ vÃ  xáº¿p háº¡ng láº¡i (Báº£ng 4), chÃºng tÃ´i láº¥y máº«u 100 CoTs Ä‘á»ƒ Ä‘Ã¡nh giÃ¡. Trong bá» phiáº¿u, cÃ¢u tráº£ lá»i há»£p lá»‡ cÃ³ sá»‘ phiáº¿u Ä‘a sá»‘ Ä‘Æ°á»£c chá»n lÃ m cÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng Ä‘á»ƒ tÃ­nh Ä‘á»™ chÃ­nh xÃ¡c. Trong xáº¿p háº¡ng láº¡i, chÃºng tÃ´i chá»n CoT cÃ³ Ä‘iá»ƒm cao nháº¥t vÃ  trÃ­ch xuáº¥t cÃ¢u tráº£ lá»i.

### 4.4 Káº¿t quáº£

**ReFT VÆ°á»£t trá»™i so vá»›i SFT** Báº£ng 2 so sÃ¡nh hiá»‡u suáº¥t giá»¯a cÃ¡c baseline vÃ  ReFT Ä‘Æ°á»£c Ä‘á» xuáº¥t trÃªn táº­p dá»¯ liá»‡u GSM8K, SVAMP, vÃ  MathQA. ChÃºng ta cÃ³ thá»ƒ quan sÃ¡t tháº¥y ReFT liÃªn tá»¥c Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t tá»‘t hÆ¡n nhiá»u so vá»›i SFT trá»« trÃªn MathQA MCQ N-CoT. Cá»¥ thá»ƒ, chÃºng tÃ´i cÃ³ cáº£i thiá»‡n gáº§n 10 Ä‘iá»ƒm vÃ  12 Ä‘iá»ƒm so vá»›i SFT vá»›i CodeLLAMA trÃªn GSM8K N-CoT vÃ  P-CoT, tÆ°Æ¡ng á»©ng. Trung bÃ¬nh, chÃºng tÃ´i Ä‘áº¡t Ä‘Æ°á»£c cáº£i thiá»‡n 6.7 Ä‘iá»ƒm vÃ  7.4 Ä‘iá»ƒm vá»›i CodeLLAMA trÃªn táº¥t cáº£ táº­p dá»¯ liá»‡u trong N-CoT vÃ  P-CoT, tÆ°Æ¡ng á»©ng. ÄÃ¡ng chÃº Ã½, khÃ´ng cÃ³ chÃº thÃ­ch bá»• sung hoáº·c mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng nÃ o Ä‘Æ°á»£c sá»­ dá»¥ng trong ReFT. Nhá»¯ng káº¿t quáº£ máº¡nh máº½ nhÆ° váº­y chá»©ng minh kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a bá»n vá»¯ng cá»§a ReFT (xem PhÃ¢n tÃ­ch Â§5) vÃ  tiá»m nÄƒng to lá»›n Ä‘á»ƒ khÃ¡m phÃ¡ thÃªm viá»‡c huáº¥n luyá»‡n vá»›i há»c tÄƒng cÆ°á»ng (Lu et al., 2023).

Self-training offline bao gá»“m dá»¯ liá»‡u láº¥y máº«u tá»« chÃ­nh sÃ¡ch ban Ä‘áº§u Ä‘á»ƒ tinh chá»‰nh. ChÃºng ta cÃ³ thá»ƒ tháº¥y baseline Ä‘Æ¡n giáº£n nÃ y cÃ³ thá»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t so vá»›i SFT (He et al., 2020; Gulcehre et al., 2023) nhÆ°ng nhá»¯ng cáº£i thiá»‡n nÃ y cÃ²n kÃ©m xa so vá»›i cáº£i thiá»‡n cá»§a ReFT. Nhá»¯ng so sÃ¡nh nhÆ° váº­y cho tháº¥y "khÃ¡m phÃ¡" lÃ  cáº§n thiáº¿t trong ReFT Ä‘á»ƒ cÃ³ hiá»‡u suáº¥t tá»‘t. Máº·c dÃ¹ online self-training Ä‘áº¡t Ä‘Æ°á»£c thÃªm má»™t sá»‘ cáº£i thiá»‡n vá»›i Galactica, nÃ³ váº«n kÃ©m xa ReFT trung bÃ¬nh. Káº¿t quáº£ nÃ y cho tháº¥y cÃ¡c instance sai cÅ©ng ráº¥t cáº§n thiáº¿t Ä‘á»ƒ hÆ°á»›ng dáº«n mÃ´ hÃ¬nh khÃ¡m phÃ¡ tá»‘t hÆ¡n. CÃ¡c so sÃ¡nh vá»›i self-training cÅ©ng gá»£i Ã½ ráº±ng phÆ°Æ¡ng phÃ¡p Ä‘Æ°á»£c Ä‘á» xuáº¥t vá»›i láº¥y máº«u on-policy vÃ  há»c tÄƒng cÆ°á»ng tá»‘t hÆ¡n cÃ¡c phÆ°Æ¡ng phÃ¡p tÄƒng cÆ°á»ng dá»¯ liá»‡u tiÃªu chuáº©n.

**Reward Hacking cho MathQA** Äiá»u tra cá»§a chÃºng tÃ´i vá» káº¿t quáº£ tiÃªu cá»±c trÃªn MathQA MCQ cho tháº¥y ReFT gáº·p pháº£i reward hacking (Skalse et al., 2022) trÃªn cÃ¢u há»i nhiá»u lá»±a chá»n trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n. HÃ¬nh 3 cho tháº¥y cÃ¡ch cÃ¡c giáº£i phÃ¡p Ä‘Æ°á»£c láº¥y máº«u táº¡o ra "pháº§n thÆ°á»Ÿng khÃ´ng chÃ­nh xÃ¡c", lÃ m cho viá»‡c huáº¥n luyá»‡n RL gáº·p khÃ³ khÄƒn. NhÆ° chÃºng ta cÃ³ thá»ƒ tháº¥y, CoT Ä‘Æ°á»£c láº¥y máº«u thu Ä‘Æ°á»£c cÃ¢u tráº£ lá»i sai "172" khÃ´ng pháº£i lÃ  má»™t ná»­a tÃ­ch cá»§a "18" vÃ  "22". Tuy nhiÃªn, bÆ°á»›c lÃ½ luáº­n cuá»‘i cÃ¹ng váº«n dá»± Ä‘oÃ¡n tÃ¹y chá»n "C" lÃ m cÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng vÃ¬ mÃ´ hÃ¬nh sáº½ luÃ´n dá»± Ä‘oÃ¡n má»™t trong cÃ¡c tÃ¹y chá»n tá»« {A, B, C, D, E} báº¥t ká»ƒ tÃ­nh Ä‘Ãºng Ä‘áº¯n cá»§a CoT trung gian. Do Ä‘Ã³, CoT gÃ¢y hiá»ƒu láº§m nhÆ° váº­y sáº½ nháº­n Ä‘Æ°á»£c pháº§n thÆ°á»Ÿng tÃ­ch cá»±c "1" vÃ  dáº«n mÃ´ hÃ¬nh sai láº§m Ä‘á»ƒ coi Ä‘Ã¢y lÃ  CoT Ä‘Ãºng. Hiá»‡n tÆ°á»£ng reward hacking cÆ¡ báº£n nÃ y lÃ m há»ng nghiÃªm trá»ng viá»‡c huáº¥n luyá»‡n mÃ´ hÃ¬nh (Everitt et al., 2021). ÄÃ¢y cÅ©ng lÃ  lÃ½ do chÃºng tÃ´i chá»n checkpoint vá»›i cÃ¡c bÆ°á»›c khá»Ÿi Ä‘á»™ng dÃ i hÆ¡n cho MathQA N-CoT Ä‘á»ƒ giáº£m hiá»‡u á»©ng reward hacking.

Äá»ƒ chá»©ng minh thÃªm hiá»‡u á»©ng tiÃªu cá»±c cá»§a cÃ¢u há»i MCQ, chÃºng tÃ´i thÃ­ nghiá»‡m trÃªn biáº¿n thá»ƒ MathQA cá»§a Jie and Lu (2023), MathQA numeric (Báº£ng 1), loáº¡i bá» cÃ¡c tÃ¹y chá»n trong cÃ¢u há»i vÃ  trá»±c tiáº¿p dá»± Ä‘oÃ¡n cÃ¢u tráº£ lá»i sá»‘. Báº£ng 3 trÃ¬nh bÃ y so sÃ¡nh vá»›i cÃ¡c baseline. ChÃºng ta cÃ³ thá»ƒ quan sÃ¡t tháº¥y ReFT liÃªn tá»¥c vÆ°á»£t trá»™i so vá»›i cÃ¡c baseline sá»­ dá»¥ng cáº£ Galactica vÃ  CodeLLAMA.

LÃ½ tÆ°á»Ÿng, chÃºng ta cÃ³ thá»ƒ giáº£m hiá»‡u á»©ng reward hacking trÃªn MathQA MCQ náº¿u chÃºng ta cÃ³ thá»ƒ thu Ä‘Æ°á»£c pháº§n thÆ°á»Ÿng chi tiáº¿t hÆ¡n (vÃ­ dá»¥, pháº§n thÆ°á»Ÿng dá»±a trÃªn quy trÃ¬nh (Lightman et al., 2023)) cho cÃ¡c bÆ°á»›c lÃ½ luáº­n trung gian. Tuy nhiÃªn, viá»‡c phÃ¡t triá»ƒn má»™t mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng dá»±a trÃªn quy trÃ¬nh Ä‘Ã¡ng tin cáº­y ráº¥t tá»‘n kÃ©m vÃ  Ä‘Ã²i há»i chÃº thÃ­ch thá»§ cÃ´ng rá»™ng rÃ£i cá»§a cÃ¡c bÆ°á»›c lÃ½ luáº­n. Nháº­n thá»©c Ä‘Æ°á»£c nhá»¯ng thÃ¡ch thá»©c nÃ y, chÃºng tÃ´i coi viá»‡c kiá»ƒm soÃ¡t reward hacking vÃ  phÃ¢n tÃ­ch cá»§a nÃ³ lÃ  má»™t váº¥n Ä‘á» quan trá»ng cáº§n Ä‘Æ°á»£c giáº£i quyáº¿t trong cÃ´ng viá»‡c tÆ°Æ¡ng lai.

**Bá» phiáº¿u Äa sá»‘ vÃ  Xáº¿p háº¡ng láº¡i CÃ³ lá»£i cho ReFT** Theo Wang et al. (2023b); Uesato et al. (2022); Lightman et al. (2023), chÃºng tÃ´i cÅ©ng thá»±c hiá»‡n bá» phiáº¿u Ä‘a sá»‘ vÃ  xáº¿p háº¡ng láº¡i mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng Ä‘á»ƒ cho tháº¥y ReFT cÃ³ thá»ƒ hÆ°á»Ÿng lá»£i tá»« cÃ¡c ká»¹ thuáº­t phá»• biáº¿n nÃ y. Cá»¥ thá»ƒ, chÃºng tÃ´i thá»±c hiá»‡n láº¥y máº«u tá»« cáº£ chÃ­nh sÃ¡ch SFT vÃ  ReFT. ChÃºng tÃ´i láº¥y máº«u 100 giáº£i phÃ¡p CoT cho má»—i cÃ¢u há»i vÃ  sá»­ dá»¥ng mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng Ä‘Æ°á»£c mÃ´ táº£ trong Â§4.3 Ä‘á»ƒ thá»±c hiá»‡n xáº¿p háº¡ng láº¡i. Káº¿t quáº£ trong Báº£ng 4 chá»©ng minh ráº±ng ReFT liÃªn tá»¥c Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t tá»‘t nháº¥t trÃªn GSM8K báº±ng xáº¿p háº¡ng láº¡i mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng. ReFT + Voting vÆ°á»£t trá»™i Ä‘Ã¡ng ká»ƒ so vá»›i SFT + Voting 8.6 Ä‘iá»ƒm trung bÃ¬nh trÃªn táº¥t cáº£ thiáº¿t láº­p. ReFT vá»›i xáº¿p háº¡ng láº¡i vÆ°á»£t trá»™i so vá»›i SFT vá»›i xáº¿p háº¡ng láº¡i hÆ¡n 3 Ä‘iá»ƒm.

So vá»›i cÃ¡c phÆ°Æ¡ng phÃ¡p mÃ£ nguá»“n má»Ÿ hiá»‡n cÃ³ (Luo et al., 2023; Wang et al., 2023a; Yue et al., 2023) (Báº£ng 4 dÆ°á»›i), biáº¿n thá»ƒ P-CoT tá»‘t nháº¥t cá»§a chÃºng tÃ´i Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t tá»‘t nháº¥t vá»›i Ä‘á»™ chÃ­nh xÃ¡c 81.2 trÃªn GSM8K. NgoÃ i ra, nhá»¯ng phÆ°Æ¡ng phÃ¡p nÃ y chá»§ yáº¿u bao gá»“m dá»¯ liá»‡u bá»• sung Ä‘Æ°á»£c táº¡o tá»« ChatGPT vÃ  thá»±c hiá»‡n chÆ°ng cáº¥t trong quÃ¡ trÃ¬nh tinh chá»‰nh. NgÆ°á»£c láº¡i, chÃºng tÃ´i cáº£i thiá»‡n chÃ­nh sÃ¡ch Ä‘Ã³ báº±ng cÃ¡ch khai thÃ¡c tiá»m nÄƒng cá»§a dá»¯ liá»‡u huáº¥n luyá»‡n hiá»‡n cÃ³ vÃ  Ä‘áº©y giá»›i háº¡n hiá»‡u suáº¥t chÃ­nh sÃ¡ch. Káº¿t quáº£ tá»‘t nháº¥t cá»§a chÃºng tÃ´i Ä‘Æ°á»£c bÃ¡o cÃ¡o trong Báº£ng 4, tá»©c lÃ  thiáº¿t láº­p CodeLLAMA + ReFT + Reranking vá»›i P-CoT, tháº­m chÃ­ cÃ²n vÆ°á»£t qua GPT-3.5-turbo. Tuy nhiÃªn, chÃºng tÃ´i Ä‘áº¡t Ä‘Æ°á»£c káº¿t quáº£ vá»›i má»™t mÃ´ hÃ¬nh chá»‰ cÃ³ kÃ­ch thÆ°á»›c 7B.

**ThÃ­ nghiá»‡m vá»›i MÃ´ hÃ¬nh Nhá»** Trá»±c quan, khÃ¡m phÃ¡ cÃ³ thá»ƒ dáº«n Ä‘áº¿n demonstration khÃ´ng hoÃ n háº£o vá»›i mÃ´ hÃ¬nh ngÃ´n ngá»¯ nhá». ChÃºng tÃ´i thá»±c hiá»‡n thÃ­ nghiá»‡m trÃªn dá»¯ liá»‡u P-CoT sá»­ dá»¥ng Galactica-125M, Codeparrot-small vÃ  Codegen-350M. Báº£ng 5 cho tháº¥y so sÃ¡nh hiá»‡u suáº¥t giá»¯a SFT vÃ  ReFT. ÄÃ¡ng ngáº¡c nhiÃªn, ReFT váº«n vÆ°á»£t trá»™i so vá»›i SFT trÃªn ba táº­p dá»¯ liá»‡u. Nhá»¯ng cáº£i thiá»‡n nhÆ° váº­y chá»©ng minh sá»± bá»n vá»¯ng cá»§a ReFT trong quÃ¡ trÃ¬nh khÃ¡m phÃ¡ cÃ¡c chÆ°Æ¡ng trÃ¬nh há»£p lÃ½.

**NghiÃªn cá»©u Ablation** ChÃºng tÃ´i thá»±c hiá»‡n nghiÃªn cá»©u ablation sá»­ dá»¥ng CodeLLAMA trÃªn GSM8K P-CoT (Báº£ng 6). KhÃ´ng cÃ³ pháº§n thÆ°á»Ÿng má»™t pháº§n, ReFT Ä‘áº¡t Ä‘Æ°á»£c Ä‘á»™ chÃ­nh xÃ¡c tháº¥p hÆ¡n 74.4 nhÆ°ng váº«n tá»‘t hÆ¡n nhiá»u so vá»›i SFT. NhÆ° Ä‘Ã£ Ä‘á» cáº­p trong Â§3.1, pháº§n thÆ°á»Ÿng má»™t pháº§n nhÆ° váº­y cÃ³ thá»ƒ giÃºp giáº£m hiá»‡u á»©ng pháº§n thÆ°á»Ÿng thÆ°a thá»›t (Trott et al., 2019) trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n. NgoÃ i ra, phÃ¢n phá»‘i chÃ­nh sÃ¡ch sáº½ dá»… dÃ ng sá»¥p Ä‘á»• Ä‘á»ƒ táº¡o ra káº¿t quáº£ khÃ´ng mong muá»‘n (tá»©c lÃ  Ä‘á»™ chÃ­nh xÃ¡c 0) náº¿u chÃºng ta Ä‘áº·t há»‡ sá»‘ KL Î² vá» 0. Cháº¯c cháº¯n lÃ  quan trá»ng Ä‘á»ƒ Ã¡p Ä‘áº·t rÃ ng buá»™c trÃªn khÃ´ng gian mÃ  chÃ­nh sÃ¡ch khÃ¡m phÃ¡ (Ouyang et al., 2022). BÆ°á»›c khá»Ÿi Ä‘á»™ng ban Ä‘áº§u vá» cÆ¡ báº£n táº¡o ra nhá»¯ng rÃ ng buá»™c nhÆ° váº­y vÃ  cho phÃ©p chÃ­nh sÃ¡ch khÃ¡m phÃ¡ thÃªm trong pháº¡m vi Ä‘Æ°á»£c Ä‘iá»u chá»‰nh bá»Ÿi Î². ChÃºng tÃ´i cÅ©ng thÃ­ nghiá»‡m vá»›i má»™t mÃ´ hÃ¬nh giÃ¡ trá»‹ riÃªng biá»‡t (Andrychowicz et al., 2021; Cobbe et al., 2021b), trong Ä‘Ã³ cÃ¡c tham sá»‘ thÃ¢n Ä‘Æ°á»£c khá»Ÿi táº¡o giá»‘ng nhÆ° mÃ´ hÃ¬nh chÃ­nh sÃ¡ch. ChÃºng tÃ´i tháº¥y ráº±ng thiáº¿t láº­p nhÆ° váº­y cho phÃ©p chÃ­nh sÃ¡ch há»™i tá»¥ nhanh hÆ¡n trong huáº¥n luyá»‡n RL sá»›m, nhÆ°ng cuá»‘i cÃ¹ng Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t ngang báº±ng. So vá»›i thiáº¿t láº­p ban Ä‘áº§u cá»§a mÃ´ hÃ¬nh giÃ¡ trá»‹ chia sáº», tuy nhiÃªn, nÃ³ gáº¥p Ä‘Ã´i chi phÃ­ tÃ­nh toÃ¡n do má»™t forward-pass bá»• sung, cÅ©ng nhÆ° gáº¥p Ä‘Ã´i chi phÃ­ bá»™ nhá»› do lÆ°u trá»¯ máº¡ng giÃ¡ trá»‹ riÃªng biá»‡t. Cuá»‘i cÃ¹ng, trong Phá»¥ lá»¥c C chÃºng tÃ´i Ä‘Æ°a ra má»™t nghiÃªn cá»©u trÆ°á»ng há»£p Ä‘á»ƒ cho tháº¥y P-CoT Ä‘Æ°á»£c táº¡o ra phÃ¡t triá»ƒn nhÆ° tháº¿ nÃ o cho SFT vÃ  ReFT.

## 5 PhÃ¢n tÃ­ch

**Tá»•ng quÃ¡t hÃ³a** HÃ¬nh 4 cho tháº¥y pháº§n thÆ°á»Ÿng trung bÃ¬nh, Ä‘á»™ chÃ­nh xÃ¡c Ä‘Ã¡nh giÃ¡, vÃ  phÃ¢n ká»³ KL trong quÃ¡ trÃ¬nh huáº¥n luyá»‡n ReFT trÃªn GSM8K P-CoT sá»­ dá»¥ng CodeLLAMA lÃ m mÃ´ hÃ¬nh ná»n. SFT há»™i tá»¥ vÃ  trá»Ÿ nÃªn overfitting khi tiáº¿n gáº§n epoch thá»© 40. Tuy nhiÃªn, chÃºng ta cÃ³ thá»ƒ tháº¥y pháº§n thÆ°á»Ÿng trung bÃ¬nh khoáº£ng 80% Ä‘áº¿n 90% cho chÃ­nh sÃ¡ch ReFT táº¡i epoch thá»© 40, vÃ  Ä‘á»™ chÃ­nh xÃ¡c giÃ¡ trá»‹ cÅ©ng Ä‘ang tÄƒng. NgoÃ i ra, chÃºng ta cÃ³ thá»ƒ tháº¥y phÃ¢n ká»³ KL (HÃ¬nh 4 (c)) ráº¥t lá»›n á»Ÿ Ä‘áº§u vÃ  sau Ä‘Ã³ duy trÃ¬ giÃ¡ trá»‹ há»£p lÃ½ giá»¯a 0 vÃ  10. PhÃ¢n ká»³ KL á»•n Ä‘á»‹nh cho tháº¥y chÃ­nh sÃ¡ch cá»§a chÃºng tÃ´i thá»±c hiá»‡n khÃ¡m phÃ¡ trong khÃ´ng gian chá»©a cÃ¡c chÆ°Æ¡ng trÃ¬nh thÃ­ch há»£p. CÆ¡ cháº¿ há»c tÄƒng cÆ°á»ng cÆ¡ báº£n cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a cá»§a ReFT (Brown et al., 2020).

**ÄÃ¡nh giÃ¡ Äá»‹nh tÃ­nh** ChÃºng tÃ´i thá»±c hiá»‡n Ä‘Ã¡nh giÃ¡ con ngÆ°á»i Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ Ä‘á»‹nh tÃ­nh Ä‘áº§u ra tá»« mÃ´ hÃ¬nh SFT, checkpoint Warmup, vÃ  mÃ´ hÃ¬nh ReFT. ÄÃ¡nh giÃ¡ sá»­ dá»¥ng 50 cÃ¢u há»i vÃ  láº¥y máº«u cÃ¡c giáº£i phÃ¡p trong táº­p test GSM8K cÃ³ thá»ƒ Ä‘Æ°á»£c giáº£i Ä‘Ãºng bá»Ÿi cáº£ ba mÃ´ hÃ¬nh. ChÃºng tÃ´i yÃªu cáº§u bá»‘n ngÆ°á»i chÃº thÃ­ch khÃ¡c nhau cháº¥m Ä‘iá»ƒm Ä‘Æ°á»ng lÃ½ luáº­n theo cÃ¡c tiÃªu chÃ­ sau, má»—i tiÃªu chÃ­ Ä‘Æ°á»£c cháº¥m Ä‘iá»ƒm tá»« 0 Ä‘áº¿n 1.

â€¢ **Logic**: Ä‘Ã¡nh giÃ¡ xem logic dáº«n Ä‘áº¿n cÃ¢u tráº£ lá»i cÃ³ Ä‘Ãºng khÃ´ng.
â€¢ **Naming**: Ä‘Ã¡nh giÃ¡ xem biáº¿n cÃ³ truyá»n Ä‘áº¡t ngá»¯ nghÄ©a thÃ­ch há»£p vÃ  há»£p lÃ½ khÃ´ng
â€¢ **Compactness**: Ä‘Ã¡nh giÃ¡ xem Ä‘Æ°á»ng lÃ½ luáº­n cÃ³ chá»©a thÃ´ng tin dÆ° thá»«a khÃ´ng.

Äiá»ƒm hoÃ n háº£o lÃ  3 cho tháº¥y hiá»‡u suáº¥t tá»‘t trÃªn ba khÃ­a cáº¡nh nÃ y. Äá»ƒ Ä‘áº£m báº£o Ä‘Ã¡nh giÃ¡ cÃ´ng báº±ng vÃ  trung thá»±c, chÃºng tÃ´i tuÃ¢n thá»§ nghiÃªm ngáº·t thiáº¿t láº­p: (1) Nguá»“n gá»‘c cá»§a má»—i Ä‘Æ°á»ng lÃ½ luáº­n (tá»« SFT, Warmup, hoáº·c ReFT) Ä‘Æ°á»£c áº©n danh Ä‘á»ƒ ngÄƒn thiÃªn vá»‹ cá»§a ngÆ°á»i chÃº thÃ­ch. (2) Bá»‘n ngÆ°á»i chÃº thÃ­ch khÃ¡c nhau chá»‹u trÃ¡ch nhiá»‡m cho cÃ¡c pháº§n khÃ¡c nhau cá»§a máº«u. NhÆ° tháº¥y trong báº£ng 7, máº·c dÃ¹ Ä‘iá»ƒm tá»•ng thá»ƒ khÃ¡ gáº§n nhau, ReFT hoáº¡t Ä‘á»™ng hÆ¡i tá»‘t hÆ¡n SFT, vÃ  vÆ°á»£t trá»™i so vá»›i biáº¿n thá»ƒ Warmup. LÆ°u Ã½ ráº±ng SFT vá»‘n Ä‘Æ°á»£c huáº¥n luyá»‡n Ä‘á»ƒ há»c tá»« ground truth, do Ä‘Ã³, cÃ³ kháº£ nÄƒng cÃ³ Ä‘iá»ƒm cao. PhÃ¢n tÃ­ch so sÃ¡nh nÃ y nháº¥n máº¡nh sá»± bá»n vá»¯ng cá»§a ReFT trong viá»‡c táº¡o ra cÃ¡c Ä‘Æ°á»ng lÃ½ luáº­n chÃ­nh xÃ¡c vÃ  máº¡ch láº¡c vá» máº·t ngá»¯ nghÄ©a.

**Khi nÃ o ReFT vÆ°á»£t trá»™i so vá»›i SFT?** Äá»ƒ Ä‘iá»u tra thÃªm má»‘i quan há»‡ giá»¯a ReFT vÃ  SFT, chÃºng tÃ´i thá»±c hiá»‡n huáº¥n luyá»‡n ReFT vá»›i sá»‘ bÆ°á»›c khá»Ÿi Ä‘á»™ng khÃ¡c nhau tá»« SFT. HÃ¬nh 5 cho tháº¥y Ä‘á»™ chÃ­nh xÃ¡c giÃ¡ trá»‹ cá»§a cÃ¡c biáº¿n thá»ƒ ReFT khÃ¡c nhau so vá»›i SFT. Cá»¥ thá»ƒ, náº¿u bÆ°á»›c warmup lÃ  3, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  chÃ­nh sÃ¡ch khá»Ÿi táº¡o tá»« checkpoint SFT epoch thá»© 3. ChÃºng ta cÃ³ thá»ƒ tháº¥y hiá»‡u suáº¥t cá»§a táº¥t cáº£ chÃ­nh sÃ¡ch ReFT giáº£m ngay sau warmup á»Ÿ Ä‘áº§u, cho Ä‘áº¿n khi epoch huáº¥n luyá»‡n Ä‘áº¡t khoáº£ng 8. VÃ¬ lá»›p tuyáº¿n tÃ­nh trong mÃ´ hÃ¬nh giÃ¡ trá»‹ chia sáº» Ä‘Æ°á»£c khá»Ÿi táº¡o ngáº«u nhiÃªn, vÃ  cÃ³ thá»ƒ máº¥t vÃ i epoch Ä‘á»ƒ Ä‘iá»u chá»‰nh phÃ¢n phá»‘i. Báº¯t Ä‘áº§u tá»« epoch thá»© 30, SFT há»™i tá»¥ vÃ  táº¥t cáº£ biáº¿n thá»ƒ ReFT váº«n Ä‘ang cáº£i thiá»‡n. ChÃºng ta cÅ©ng cÃ³ thá»ƒ tháº¥y táº¥t cáº£ biáº¿n thá»ƒ Ä‘á»u vÆ°á»£t trá»™i so vá»›i SFT vá»›i biÃªn Ä‘á»™ Ä‘Ã¡ng ká»ƒ vÃ  khÃ´ng cÃ³ lá»£i tháº¿ rÃµ rÃ ng cá»§a báº¥t ká»³ biáº¿n thá»ƒ ReFT cá»¥ thá»ƒ nÃ o.

## 6 Káº¿t luáº­n

ChÃºng tÃ´i Ä‘Ã£ giá»›i thiá»‡u tinh chá»‰nh cÃ³ tÄƒng cÆ°á»ng (ReFT) nhÆ° má»™t phÆ°Æ¡ng phÃ¡p má»›i Ä‘á»ƒ tinh chá»‰nh mÃ´ hÃ¬nh giáº£i toÃ¡n. NgÆ°á»£c láº¡i vá»›i SFT, ReFT tá»‘i Æ°u hÃ³a má»™t má»¥c tiÃªu khÃ´ng kháº£ vi báº±ng cÃ¡ch khÃ¡m phÃ¡ nhiá»u chÃº thÃ­ch CoT trong viá»‡c tÃ¬m kiáº¿m cÃ¢u tráº£ lá»i Ä‘Ãºng, thay vÃ¬ dá»±a vÃ o má»™t chÃº thÃ­ch duy nháº¥t.

ThÃ´ng qua thÃ­ nghiá»‡m má»Ÿ rá»™ng trÃªn ba táº­p dá»¯ liá»‡u sá»­ dá»¥ng hai mÃ´ hÃ¬nh ná»n, chÃºng tÃ´i Ä‘Ã£ chá»©ng minh ráº±ng ReFT vÆ°á»£t trá»™i so vá»›i SFT vá» hiá»‡u suáº¥t vÃ  kháº£ nÄƒng tá»•ng quÃ¡t hÃ³a. HÆ¡n ná»¯a, chÃºng tÃ´i Ä‘Ã£ thá»ƒ hiá»‡n tÃ­nh tÆ°Æ¡ng thÃ­ch cá»§a cÃ¡c mÃ´ hÃ¬nh Ä‘Æ°á»£c huáº¥n luyá»‡n vá»›i ReFT vá»›i cÃ¡c ká»¹ thuáº­t nhÆ° bá» phiáº¿u Ä‘a sá»‘ (Wang et al., 2023b) vÃ  xáº¿p háº¡ng láº¡i mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng (Cobbe et al., 2021a; Uesato et al., 2022).

HÆ¡n ná»¯a, ReFT Ä‘Ã£ thá»ƒ hiá»‡n hiá»‡u suáº¥t vÆ°á»£t trá»™i so vá»›i má»™t sá»‘ mÃ´ hÃ¬nh mÃ£ nguá»“n má»Ÿ cÃ³ sáºµn cÃ´ng khai cÃ³ kÃ­ch thÆ°á»›c tÆ°Æ¡ng Ä‘Æ°Æ¡ng trong giáº£i toÃ¡n. Äiá»u nÃ y chá»©ng minh tÃ­nh hiá»‡u quáº£ vÃ  giÃ¡ trá»‹ thá»±c tiá»…n cá»§a phÆ°Æ¡ng phÃ¡p ReFT.

## 7 NghiÃªn cá»©u tÆ°Æ¡ng lai

ChÃºng tÃ´i Ä‘Ã£ thá»±c hiá»‡n ná»— lá»±c Ä‘áº§u tiÃªn Ã¡p dá»¥ng há»c tÄƒng cÆ°á»ng, cá»¥ thá»ƒ lÃ  thuáº­t toÃ¡n PPO (Schulman et al., 2017), vÃ o tinh chá»‰nh LLMs cho giáº£i toÃ¡n. NghiÃªn cá»©u tÆ°Æ¡ng lai cá»§a chÃºng tÃ´i bao gá»“m viá»‡c sá»­ dá»¥ng cÃ¡c ká»¹ thuáº­t há»c tÄƒng cÆ°á»ng offline (Levine et al., 2020; Gulcehre et al., 2023), phÃ¡t triá»ƒn phÆ°Æ¡ng phÃ¡p khÃ´ng cáº§n khá»Ÿi Ä‘á»™ng Ä‘á»ƒ nÃ¢ng cao hiá»‡u quáº£ vÃ  hiá»‡u suáº¥t huáº¥n luyá»‡n, tá»« Ä‘Ã³ giáº£m khoáº£ng cÃ¡ch vá»›i phÆ°Æ¡ng phÃ¡p xáº¿p háº¡ng láº¡i. NgoÃ i ra, Lightman et al. (2023) gá»£i Ã½ ráº±ng má»™t mÃ´ hÃ¬nh pháº§n thÆ°á»Ÿng dá»±a trÃªn quy trÃ¬nh (PRM) Ä‘Æ°á»£c huáº¥n luyá»‡n tá»‘t cÃ³ thá»ƒ nÃ¢ng cao Ä‘Ã¡ng ká»ƒ hiá»‡u suáº¥t. Do Ä‘Ã³, sáº½ Ä‘Ã¡ng Ä‘á»ƒ khÃ¡m phÃ¡ viá»‡c triá»ƒn khai pháº§n thÆ°á»Ÿng dá»±a trÃªn quy trÃ¬nh trong huáº¥n luyá»‡n há»c tÄƒng cÆ°á»ng. Cuá»‘i cÃ¹ng, vÃ¬ ReFT lÃ  má»™t phÆ°Æ¡ng phÃ¡p linh hoáº¡t, chÃºng tÃ´i dá»± Ä‘á»‹nh Ã¡p dá»¥ng nÃ³ cho cÃ¡c tÃ¡c vá»¥ lÃ½ luáº­n tá»•ng quÃ¡t hÆ¡n trong Ä‘Ã³ suy luáº­n cÃ³ thá»ƒ Ä‘Æ°á»£c hÃ¬nh thá»©c hÃ³a vá»›i CoT.

## Háº¡n cháº¿

**Hiá»‡u quáº£ Huáº¥n luyá»‡n** NhÆ° Ä‘Æ°á»£c mÃ´ táº£ trong HÃ¬nh 4 (b), rÃµ rÃ ng lÃ  ReFT cáº§n sá»‘ epoch lá»›n hÆ¡n Ä‘á»ƒ Ä‘áº¡t há»™i tá»¥ so vá»›i SFT. Äiá»u nÃ y chá»§ yáº¿u do ReFT tá»‘i Æ°u hÃ³a má»™t má»¥c tiÃªu khÃ´ng kháº£ vi vÃ  yÃªu cáº§u khÃ¡m phÃ¡ khÃ´ng gian táº¡o Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c cÃ¢u tráº£ lá»i Ä‘Ãºng. Trong khi learning rate lá»›n hÆ¡n cÃ³ thá»ƒ Ä‘áº©y nhanh há»™i tá»¥, nÃ³ cÅ©ng lÃ m cho chÃ­nh sÃ¡ch dá»… bá»‹ báº¥t á»•n Ä‘á»‹nh vÃ  cÃ³ kháº£ nÄƒng sá»¥p Ä‘á»•. Thay vÃ o Ä‘Ã³, sá»­ dá»¥ng kÃ­ch thÆ°á»›c batch lá»›n hÆ¡n lÃ  má»™t lá»±a chá»n kháº£ thi; tuy nhiÃªn, nÃ³ cÃ³ chi phÃ­ tÃ­nh toÃ¡n tÄƒng lÃªn.

**Reward Hacking** HÃ m pháº§n thÆ°á»Ÿng cá»§a chÃºng tÃ´i chá»‰ dá»±a vÃ o cÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh pháº§n thÆ°á»Ÿng. Tuy nhiÃªn, nhÆ° Ä‘Ã£ chá»©ng minh trong cÃ¡c thÃ­ nghiá»‡m Ä‘Æ°á»£c thá»±c hiá»‡n trÃªn táº­p dá»¯ liá»‡u MathQA MCQ N-CoT, chÃ­nh sÃ¡ch cÃ³ thá»ƒ dá»… dÃ ng bá»‹ thao tÃºng náº¿u khÃ´ng gian cÃ³ thá»ƒ cá»§a cÃ¢u tráº£ lá»i cuá»‘i cÃ¹ng bá»‹ háº¡n cháº¿, cháº³ng háº¡n nhÆ° A,B,C,D. Äá»ƒ giáº£m thiá»ƒu váº¥n Ä‘á» reward hacking, cÃ³ thá»ƒ cáº§n sá»­ dá»¥ng hÃ m pháº§n thÆ°á»Ÿng chi tiáº¿t hÆ¡n hoáº·c dá»±a trÃªn quy trÃ¬nh cÃ³ tÃ­nh Ä‘áº¿n pháº¡m vi yáº¿u tá»‘ rá»™ng hÆ¡n.
